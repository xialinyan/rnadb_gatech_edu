function setSlider(a){a=$(a);/[0-9]+/.test(a.val())&&(console.debug($("#"+a.attr("sliderId")).slider),$("#"+a.attr("sliderId")).slider("value",a.val()),a.old=a.value)}
function sliderRange(a,b,c,d,e){a.html('<label for="min'+b+'">Min: </label><input type="text" id="min'+b+'" sliderId="slider'+b+'" name="min'+b+'" style="width:70px;" value="'+c/e+'"" onblur="getSetSizeOut();" /><span id="slider'+b+'" style="width:50%;display:inline-block;margin-left:20px;margin-right:20px;"></span><label for="max'+b+'">Max: </label><input type="text" id="max'+b+'" sliderId="slider'+b+'" name="max'+b+'" style="width:70px;" value="'+d/e+'"" onblur="getSetSizeOut();" />');var f=$("#slider"+
b).slider({range:!0,min:c,max:d,values:[c,d],slide:function(a,c){a&&c&&($("#min"+b).val(c.values[0]/e),$("#max"+b).val(c.values[1]/e))}});$("#slider"+b).live("blur",getSetSizeOut);$("#min"+b).change(function(){var a=f.slider("option","values");a[0]=$("#min"+b).val()*e;f.slider("option","values",a)});$("#max"+b).change(function(){var a=f.slider("option","values");a[1]=$("#max"+b).val()*e;f.slider("option","values",a)})}var currSizeId=0;
function populateFormElement(a){a.family=($("#familytRNA").is(":checked")?"tRna,":"")+($("#family5S").is(":checked")?"5S,":"")+($("#family16S").is(":checked")?"16S,":"")+($("#family23S").is(":checked")?"23S,":"");0<a.family.length&&(a.family=a.family.substring(0,a.family.length-1));a.ambiguous=$("#ambiguous").is(":checked");a.aligned=$("#aligned").is(":checked");a.seqLength=$("#sliderSeqLen").slider("option","values");a.mfeAccuracy=$.extend(!0,[],$("#sliderPredAcc").slider("option","values"));a.mfeAccuracy[0]/=
1E3;a.mfeAccuracy[1]/=1E3;a.name=$("#fileName").val();a.natDensity=$.extend(!0,[],$("#sliderNatBpDen").slider("option","values"));a.natDensity[0]/=1E3;a.natDensity[1]/=1E3;a.predDensity=$.extend(!0,[],$("#sliderPredBpDen").slider("option","values"));a.predDensity[0]/=1E3;a.predDensity[1]/=1E3;a.stuffedDensity=$.extend(!0,[],$("#sliderStuffedBpDen").slider("option","values"));a.stuffedDensity[0]/=1E3;a.stuffedDensity[1]/=1E3}
function updateConfirmText(a){$("#confirmFamily").html(a.family);$("#confirmAmbiguous").html(a.ambiguous?"Allowed":"Not Allowed");$("#confirmAligned").html(a.aligned?"Required":"Not Required");$("#confirmLenMin").html(a.seqLength[0]);$("#confirmLenMax").html(a.seqLength[1]);$("#confirmMfeAccMin").html(a.mfeAccuracy[0]);$("#confirmMfeAccMax").html(a.mfeAccuracy[1]);$("#confirmName").html(a.name);$("#confirmNatDenMin").html(a.natDensity[0]);$("#confirmNatDenMax").html(a.natDensity[1]);$("#confirmPredDenMin").html(a.predDensity[0]);
$("#confirmPredDenMax").html(a.predDensity[1]);$("#confirmStuffedDenMin").html(a.stuffedDensity[0]);$("#confirmStuffedDenMax").html(a.stuffedDensity[1])}function getSetSizeOut(){currSizeId++;var a={};a.sizeId=currSizeId;populateFormElement(a);updateConfirmText(a);$.ajax({type:"POST",url:"scripts/rnadb_api.php?getSize",data:a,success:getSetSizeIn});console.debug("sent")}
function getSetSizeIn(a){console.debug(a);a=JSON.parse(a);a.setId==currSizeId&&($("#sizeBox").html("&nbsp;"),$("<span>Set Size: "+a.setSize+"</span>").hide().appendTo("#sizeBox").fadeIn(2E3))}
function submitSearch(){var a={};populateFormElement(a);$('<form id="searchForm" method="POST" action="results.php"></form>').appendTo("body");$("<input>").attr({type:"hidden",name:"family",value:a.family}).appendTo("#searchForm");$("<input>").attr({type:"hidden",name:"ambiguous",value:a.ambiguous}).appendTo("#searchForm");$("<input>").attr({type:"hidden",name:"aligned",value:a.aligned}).appendTo("#searchForm");$("<input>").attr({type:"hidden",name:"lenmin",value:a.seqLength[0]}).appendTo("#searchForm");
$("<input>").attr({type:"hidden",name:"lenmax",value:a.seqLength[1]}).appendTo("#searchForm");$("<input>").attr({type:"hidden",name:"mfeaccmin",value:a.mfeAccuracy[0]}).appendTo("#searchForm");$("<input>").attr({type:"hidden",name:"mfeaccmax",value:a.mfeAccuracy[1]}).appendTo("#searchForm");$("<input>").attr({type:"hidden",name:"name",value:a.name}).appendTo("#searchForm");$("<input>").attr({type:"hidden",name:"natdenmin",value:a.natDensity[0]}).appendTo("#searchForm");$("<input>").attr({type:"hidden",
name:"natdenmax",value:a.natDensity[1]}).appendTo("#searchForm");$("<input>").attr({type:"hidden",name:"preddenmin",value:a.predDensity[0]}).appendTo("#searchForm");$("<input>").attr({type:"hidden",name:"preddenmax",value:a.predDensity[1]}).appendTo("#searchForm");$("<input>").attr({type:"hidden",name:"stuffeddenmin",value:a.stuffedDensity[0]}).appendTo("#searchForm");$("<input>").attr({type:"hidden",name:"stuffeddenmax",value:a.stuffedDensity[1]}).appendTo("#searchForm");return $("#searchForm").submit()}
var offset=0,setSize=100,allDownloaded=0,appendTime=0;function changeAllCheckboxes(){$("INPUT[type='checkbox']").attr("checked",$("#cbAll").is(":checked"))}
function downloadOut(a){if("all"==a&&allDownloaded)alert("All sequences have already been downloaded:\n"+allDownloaded);else{if("all"==a)allDownloaded=1,$.ajax({type:"POST",url:"scripts/rnadb_api.php?downloadAll",data:searchParams,success:downloadIn});else{var b="";$("INPUT[type='checkbox']").each(function(){var c=$(this);"curr"==a|"checked"==c.attr("checked")&&c.attr("rnaId")&&(b+=c.attr("rnaId")+",")});0<b.length&&(b=b.substring(0,b.length-1));var c={};c.selected=b;$.ajax({type:"POST",url:"scripts/rnadb_api.php?download",
data:c,success:downloadIn})}$("#downloadLinksLoading").html("<img src='images/loading_small.gif' />")}}
function downloadIn(a){console.debug(a);$("#downloadLinksLoading").html("");appendTime||($("#downloadLinks").html(""),appendTime=1);a=JSON.parse(a);a.link?(1==allDownloaded&&(allDownloaded=a.link),$("<p>Download Zipped File: <a href='"+a.link+"'>"+a.link+"</a></p>").hide().appendTo("#downloadLinks").fadeIn(2E3)):$("<p style='color:red;'>Download Error: "+a.error+"</p>").hide().appendTo("#downloadLinks").fadeIn(2E3)}
function searchOut(a){searchParams.offset=a;$.ajax({type:"POST",url:"scripts/rnadb_api.php?search",data:searchParams,success:searchIn});$("#setSelectionLinks").html("<img src='images/loading_small.gif' />")}
function searchIn(a){if(a=JSON.parse(a)){offset=a.offset;initTable();var b=$("#rnaTable"),c;for(c in a.rows){var d=a.rows[c];b.append('<tr><td><input type="checkbox" rnaId='+d.rid+" /></td><td>"+d.name+"</td><td>"+d.family+"</td><td>"+d.seqLength+"</td><td>"+d.mfeAcc+"</td><td>"+d.natDensity+"</td><td>"+d.predDensity+"</td><td>"+d.stuffedDensity+"</td><td>"+(d.ambiguous?"Yes":"No")+"</td><td>"+(d.alignment?"Yes":"No")+"</td></tr>")}}populateSetSelectionLinks()}
function populateSetSelectionLinks(){populateSetSelectionLinks2($("#setSelectionLinks1"));populateSetSelectionLinks2($("#setSelectionLinks2"))}
function populateSetSelectionLinks2(a){a.html("");var b=0<offset?offset-setSize:offset;if(0!=b){var c;a.append($("<span>...&nbsp;&nbsp;::&nbsp;&nbsp;</span>"))}for(var d=0;b+setSize<max&&6>d;b+=setSize,d++)c="<span>",b!=offset&&(c="<a href='#' onclick='searchOut("+b+");return false;'>"),c+=b+"-"+(b+setSize-1),b!=offset&&(c+="</a>"),c+="&nbsp;&nbsp;::&nbsp;&nbsp;</span>",a.append($(c));6==d&&a.append($("<span>...&nbsp;&nbsp;::&nbsp;&nbsp;</span>"));b=Math.floor(max/setSize)*setSize;c="<span>";b!=offset&&
(c="<a href='#' onclick='searchOut("+b+");return false;'>");c+=b+"-"+max;b!=offset&&(c+="</a>");a.append($(c+"</span>"))}function initTable(){$("#rnaTable").html('<tr><th><input id="cbAll" type="checkbox" onclick="changeAllCheckboxes();" /></th><th>Name</th><th>Family</th><th>Seq. Length</th><th>MFE Acc.</th><th>Native Density</th><th>Predicted Density</th><th>Stuffed Density</th><th>Ambiguous</th><th>Aligned</th></tr>')};